(function(a,b,c){a.fn.tagger=function(b){function d(a){a.attr("size",parseInt(a.attr("size"))+1)}function e(a){a.attr("size",parseInt(a.attr("size"))-1)}function f(a,b){return a.separator.charCodeAt(0)==b}function g(a,b){return a.separator.charAt(0)==b.charAt(0)}function h(a,b){if(b.acceptedTagRegex!=c)return b.acceptedTagRegex.test(a);else if(b.rejectedTagRegex!=c)return!b.rejectedTagRegex.test(a);else return true}function i(b,d,e,f){if(d.limit==c||e.parent().find("span."+d.tagClass).length<d.limit){if(b!=c&&b!=""){if(h(b,d)){var g=a("<a class='"+d.closeClass+"'>"+d.closeChar+"</a>").click(function(){a(this).parent().remove();f.val(f.val().replace(b+",",""))});var i=c,j="";if(d.useColorFunction)i=d.colorFunction(b);var k=a("<span class='"+d.tagClass+"'>"+b+"</span>").append(g);if(i!=c)k.css({color:i.font,"background-color":i.background});k.insertBefore(e);e.next().val(b+d.separator+e.next().val());d.tagPlacedCallback(k,b)}else{d.rejectedTagCallback(e,b)}}}else{d.limitReachedCallback()}e.attr("size","1")}var j=a.extend({},a.fn.tagger.defaults,b);return this.each(function(){var b=a(this);var c=b.attr("name");b.attr("size","1");if(j.oldInputPersistence)b.attr("name",j.oldInputPersistencePattern.replace("{old}",c));else b.attr("name","");var h=a("<input type='hidden' name='"+c+"' />");var k=a("<div class='"+j.taggerWrapperClass+"'></div>");k.css("width",j.width);b.replaceWith(k);k.append(b).append(h);k.click(function(){b.focus()});var l=b.val();var m="";for(var n=0;n<l.length;n++){if(g(j,l.charAt(n))){m=a.trim(m);i(m,j,b,h);m=""}else{m+=l.charAt(n);if(n==l.length-1){m=a.trim(m);i(m,j,b,h);m=""}}}b.val("");for(var n=0;n<j.startWith.length;n++)i(j.startWith[n],j,b,h);var o=false;b.keypress(function(b){var c=a(this);if(f(j,b.which)){var e=a.trim(a(this).val());e=e.substr(0,e.length);i(e,j,c,h);c.val("");return false}else{d(c)}return true});b.keydown(function(b){if(b.which==8){if(a.trim(a(this).val())!=""){e(a(this));return true}if(a(this).prev().length>0){$rtag=a(this).prev().find("a").trigger("click")}return false}if(b.which==13){var c=a.trim(a(this).val());c=c.substr(0,c.length);i(c,j,a(this),h);a(this).val("");return false}return true});b.focusout(function(b){var c=a.trim(a(this).val());c=c.substr(0,c.length);i(c,j,a(this),h);a(this).val("")})})};a.fn.tagger.defaults={separator:",",width:"100%",useColorFunction:true,colorFunction:function(a){return{font:"#333",background:"#CCC"}},startWith:new Array,closeChar:"x",tagClass:"tag",taggerWrapperClass:"tagger-input-container",closeClass:"close",tagPlacedCallback:function(a,b){},rejectedTagCallback:function(a,b){},limitReachedCallback:function(){},acceptedTagRegex:c,rejectedTagRegex:c,limit:c,oldInputPersistence:true,oldInputPersistencePattern:"old_{old}"}})(jQuery,window)